# PySpark_candle
Building сandlestick chart from a raw csv file using python+pySpark

# Описание практического задания

## Последовательность действий

1. **Знакомство с материалом**: изучение лекционного материала (презентации с озвучкой в PowerPoint) и самопроверка по тестовым вопросам.
2. **Установка ПО**: самостоятельная локальная установка необходимого программного обеспечения для работы с pySpark. Инструкция по установке приведена в конце данного документа.
3. **Разработка программы**: написание программы на Python с использованием pySpark, преобразующей исходные данные (набор строк, описывающих сделки с финансовыми инструментами) в данные, содержащие описание сделок в формате японских свечей.

---

## Формат входных данных

Программа принимает .csv-файл с разделителями- запятыми. Пример файла доступен по ссылке: [пример файла](https://m.cs.msu.ru/s/mA4xyL6ytqAEE8f).

### Структура входного файла

Первая строка содержит заголовки:
```
#SYMBOL,SYSTEM,MOMENT,ID_DEAL,PRICE_DEAL,VOLUME,OPEN_POS,DIRECTION
```

#### Описание используемых колонок:
- **#SYMBOL** – название финансового инструмента (акции/облигации);
- **MOMENT** – время (дата) сделки в формате `YYYYMMDDhhmmssfff`;
- **PRICE_DEAL** – цена сделки.

### Пример строки входного файла
```
SVH1,F,20110111100000080,255223067,30.46000,1,8714,S
```

Файл отсортирован по дате и времени.

---

## Параметры программы

Программа поддерживает опциональный конфигурационный файл `config.xml`, содержащий параметры (значения по умолчанию указаны после `=`):

```
candle.width = 300000 // ширина свечи в миллисекундах
candle.date.from = 19000101 // начало периода (ГГГГММДД)
candle.date.to = 20200101 // конец периода (ГГГГММДД)
candle.time.from = 1000 // начало периода (ЧЧММ)
candle.time.to = 1800 // конец периода (ЧЧММ)
```

Каждый параметр может отсутствовать в файле, в этом случае используется значение по умолчанию.

---

## Формат выходных данных

Программа создает набор файлов `.csv`. Имя каждого файла включает название инструмента (`SYMBOL`).

Выходные файлы **не содержат заголовков** и имеют формат:
```
SYMBOL,MOMENT,OPEN,HIGH,LOW,CLOSE
```

### Описание колонок выходного файла:
- **MOMENT** – время начала свечи;
- **OPEN** – цена первой сделки в свечном периоде;
- **HIGH** – максимальная цена в свечном периоде;
- **LOW** – минимальная цена в свечном периоде;
- **CLOSE** – цена последней сделки в свечном периоде.

### Пример строки выходного файла
```
GDH1,20110111100000000,1407.0,1407.0,1379.0,1379.3
```

---

## Логика построения свечей

- Свечи строятся от `candle.time.from` до `candle.time.to` каждого дня.
- Переход через сутки не рассматривается (анализ выполняется в пределах одного дня).
- В конце периода (`candle.time.to`) начинается новая свеча, но она не учитывается.
- `candle.time.from` всегда кратно `candle.width`.
- Если несколько записей имеют одинаковый `MOMENT`, но разные `PRICE_DEAL`, используются `ID_DEAL`:
  - **OPEN** – цена сделки с наименьшим `ID_DEAL`.
  - **CLOSE** – цена сделки с наибольшим `ID_DEAL`.

---

## Итоговый результат

На выходе – директория с `.csv`-файлами, содержащими свечные данные по каждому финансовому инструменту.

